# Movie Search Engine


free form search on plot overviews
## Dataset:
https://www.kaggle.com/rounakbanik/the-movies-dataset


## Dependencies:
csv, nltk, numpy, json, flask, pandas <br/>
Python 3.7

## app url
http://emmanuelrocha001.pythonanywhere.com/

## How to run locally:
python app.py <br/> <br/>
runs on localhost:5000
 

## Dataset pre-processing
### Tokenization
  __[1]:__ change casing to lowercase <br/>
  __[2]:__ remove punctuation <br/>
  __[3]:__ filter out stop-words <br/>

### Posting Lists

dataset tokens are processed and a json file is generated with the following data<br/><br/>
__term__: unique term in the dataset<br/>
__frequency__: number of times the term appears in the dataset<br/>
__posting list__: documents in which the term appears<br/><br/>

| term         | frequency      |  posting list |
| :---         |     :---:      |          ---: |
| led          | 484            | \[0, 218, 372, 443...\]  |

## Document Ranking

### Term frequency
__TF(t):__ ( Number of times term t appears in a document ) / ( Total number of terms in the document )
### Inverse Document Frequency
__IDF(t):__ log ( Total number of documents / Number of documents with term t in it ).
### Term frequency-Inverse document frequency
__TF-IDF(t):__ tf(t) x idf(t)
### Overall Document Score
__Score:__  sum of the tf-idf for each term in the query

## Challenges
The size of the dataset, around 40k documents, was considerably larger than anything I had worked with in the past. My first instinct was to utilize javascript for both pre-processing and document score calculation, but given the size of the data this quickly proved to be not feasible. As recommended, I switched over to Flask. By Utilizing both Pandas and NLTK generating the posting lists became trivial. Given my new workflow environment, document scoring also did not prove to be too cumbersome to implement. The next challenge faced was figuring out a way to get user input, in this case the search query. The easiest method I found was parametrizing the url. In addition, displaying the information generated proved to be more challenging, as they are not set html files and are generated by the jinja engine using templates. Although the engine provides an environment that is more flexible and reusable, it can quickly become cumbersome to work with and does not always feel intuitive.

## References
__tf-idf__<br/>
https://en.wikipedia.org/wiki/Tf%E2%80%93idf

# Classifier
genre classification on provided text
## Dataset pre-processing

Feature lists are processed from the csv file. The Feature lists along with the Posting lists are use to generate the json file containing the pre-processed data require for classification calculations. Data format is shown below.<br/>

### Feature Lists
__document id__: document index<br/>
__terms__: a list of terms and their corresponding frequencies in the current document<br/>
__genre__: pre-assigned genre<br/><br/>

| Document id  | terms      |  genre |
| :---         |     :---:      |          ---: |
| 0          | { "led": 1, "Buzz": 2, "Woody": 3 }        | Animation  |

### Genres pre-processed data
__vocabulary size__: number of unique terms in the dataset<br/>
__genres__: a list of unique genres, and both the total terms in genre and probability<br/><br/>

| vocabulary size  | genres       |  
| :---         |     :---:      |        
| 73943          | { "Animation": { "total_term_in_genre": 1120 , "probability": 0.026566095021229155 }, ... }        | 

### Terms pre-processed data
__term__: term in vocabulary<br/>
__genres__: a list of genres and corresponding frequencies in which the term appears in<br/><br/>

| term  | frequencies       |  
| :---         |     :---:      |        
| woody          | {"Animation": 6, "Adventure": 0, "Romance": 0, "Comedy": 11...}       | 

## Naive Bayes Classifier
### Bayes Theorem
<a href="https://www.codecogs.com/eqnedit.php?latex=P(A|B)&space;=&space;\frac{P(B|A)*P(A)}{P(B)}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?P(A|B)&space;=&space;\frac{P(B|A)*P(A)}{P(B)}" title="P(A|B) = \frac{P(B|A)*P(A)}{P(B)}" /></a>
<br/><br/>The equation can be written as:<br/><br/>
<a href="https://www.codecogs.com/eqnedit.php?latex=Posterior&space;=&space;\frac{prior*likelyhood}{evidence}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?Posterior&space;=&space;\frac{prior*likelyhood}{evidence}" title="Posterior = \frac{prior*likelyhood}{evidence}" /></a>

### Calculations
### Probability of a genre
<a href="https://www.codecogs.com/eqnedit.php?latex=P(Animation)&space;=&space;\frac{number\&space;of\&space;documents\&space;that\&space;are\&space;categorized\&space;as\&space;Animation}{number\&space;of\&space;total\&space;documents}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?P(Animation)&space;=&space;\frac{number\&space;of\&space;documents\&space;that\&space;are\&space;categorized\&space;as\&space;Animation}{number\&space;of\&space;total\&space;documents}" title="P(Animation) = \frac{number\ of\ documents\ that\ are\ categorized\ as\ Animation}{number\ of\ total\ documents}" /></a>
### Probability a word being in a genre
<a href="https://www.codecogs.com/eqnedit.php?latex=n_k&space;=&space;Number\&space;of\&space;times\&space;a\&space;word\&space;appears\&space;in\&space;the\&space;given\&space;genre" target="_blank"><img src="https://latex.codecogs.com/gif.latex?n_k&space;=&space;Number\&space;of\&space;times\&space;a\&space;word\&space;appears\&space;in\&space;the\&space;given\&space;genre" title="n_k = Number\ of\ times\ a\ word\ appears\ in\ the\ given\ genre" /></a>
<br/>
<br/>
in the event the term does not appear in the given genre, Laplace smoothing is used to avoid 0 probability
<br/>
<br/>

<a href="https://www.codecogs.com/eqnedit.php?latex=Laplace\&space;Smoothing&space;=&space;1" target="_blank"><img src="https://latex.codecogs.com/gif.latex?Laplace\&space;Smoothing&space;=&space;1" title="Laplace\ Smoothing = 1" /></a>

<br/>

<a href="https://www.codecogs.com/eqnedit.php?latex=n&space;=\&space;total\&space;number\&space;of\&space;terms\&space;in\&space;the\&space;given\&space;genre" target="_blank"><img src="https://latex.codecogs.com/gif.latex?n&space;=\&space;total\&space;number\&space;of\&space;terms\&space;in\&space;the\&space;given\&space;genre" title="n =\ total\ number\ of\ terms\ in\ the\ given\ genre" /></a>

<br/>

<a href="https://www.codecogs.com/eqnedit.php?latex=|&space;Vocabulary|&space;=&space;\&space;number\&space;of\&space;unique\&space;terms\&space;in\&space;the\&space;dataset" target="_blank"><img src="https://latex.codecogs.com/gif.latex?|&space;Vocabulary|&space;=&space;\&space;number\&space;of\&space;unique\&space;terms\&space;in\&space;the\&space;dataset" title="| Vocabulary| = \ number\ of\ unique\ terms\ in\ the\ dataset" /></a>

<br/>

<a href="https://www.codecogs.com/eqnedit.php?latex=P(\&space;Word_{k}\&space;|\&space;Genre)&space;=&space;\frac{&space;n_{k}&space;&plus;&space;Laplace\&space;Smoothing}{&space;n&space;&plus;&space;|\&space;Vocabulary\&space;|}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?P(\&space;Word_{k}\&space;|\&space;Genre)&space;=&space;\frac{&space;n_{k}&space;&plus;&space;Laplace\&space;Smoothing}{&space;n&space;&plus;&space;|\&space;Vocabulary\&space;|}" title="P(\ Word_{k}\ |\ Genre) = \frac{ n_{k} + Laplace\ Smoothing}{ n + |\ Vocabulary\ |}" /></a>
### Probability of a document being classified as a genre
<a href="https://www.codecogs.com/eqnedit.php?latex=score&space;=&space;\&space;P(Genre)\&space;\prod_{w\epsilon&space;words}&space;P(Word_k\&space;|\&space;Genre)" target="_blank"><img src="https://latex.codecogs.com/gif.latex?score&space;=&space;\&space;P(Genre)\&space;\prod_{w\epsilon&space;words}&space;P(Word_k\&space;|\&space;Genre)" title="score = \ P(Genre)\ \prod_{w\epsilon words} P(Word_k\ |\ Genre)" /></a>
### Predicted Genre 
<a href="https://www.codecogs.com/eqnedit.php?latex=Genre_{predicted}&space;=&space;\arg\max_{G_i\epsilon&space;G}(\&space;P(G_i)\&space;\prod_{w\epsilon&space;words}&space;P(Word_k\&space;|\&space;G_i)" target="_blank"><img src="https://latex.codecogs.com/gif.latex?Genre_{predicted}&space;=&space;\arg\max_{G_i\epsilon&space;G}(\&space;P(G_i)\&space;\prod_{w\epsilon&space;words}&space;P(Word_k\&space;|\&space;G_i)" title="Genre_{predicted} = \arg\max_{G_i\epsilon G}(\ P(G_i)\ \prod_{w\epsilon words} P(Word_k\ |\ G_i)" /></a>
<br/>

